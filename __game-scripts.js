var Movement=pc.createScript("movement");Movement.prototype.initialize=function(){this.stats=this.entity.script.playerStats,this.input=new pc.Vec3,this.tmpPos=new pc.Vec3},Movement.prototype.update=function(t){const e=this.app.keyboard;let i=0,s=0;e.isPressed(pc.KEY_W)&&(s-=1),e.isPressed(pc.KEY_S)&&(s+=1),e.isPressed(pc.KEY_A)&&(i-=1),e.isPressed(pc.KEY_D)&&(i+=1),this.input.set(i,0,s),this.input.lengthSq()>0&&(this.input.normalize().scale(this.stats.moveSpeed*t),this.tmpPos.add2(this.entity.getPosition(),this.input),this.entity.rigidbody.teleport(this.tmpPos,this.entity.getRotation()))};var EnemyFollow=pc.createScript("enemyFollow");EnemyFollow.prototype.initialize=function(){this.stats=this.entity.script.enemyStats,this.tmp=new pc.Vec3,this.dir=new pc.Vec3;let t=this.app.root.findByTag("player");this.player=t.length>0?t[0]:null},EnemyFollow.prototype.update=function(t){if(!this.player)return;const i=this.entity.getPosition(),e=this.player.getPosition();if(this.dir.sub2(e,i),this.dir.y=0,this.dir.lengthSq()<.001)return;this.dir.normalize(),this.entity.translate(this.dir.scale(this.stats.speed*t));const s=Math.atan2(this.dir.x,this.dir.z)*pc.math.RAD_TO_DEG;this.entity.setEulerAngles(0,s,0)};var EnemySpawner=pc.createScript("enemySpawner");EnemySpawner.attributes.add("player",{type:"entity"}),EnemySpawner.attributes.add("enemyTemplate",{type:"entity"}),EnemySpawner.attributes.add("spawnInterval",{type:"number",default:5}),EnemySpawner.attributes.add("spawnRadius",{type:"number",default:15}),EnemySpawner.attributes.add("spawnAmount",{type:"number",default:1}),EnemySpawner.prototype.initialize=function(){this.timer=0},EnemySpawner.prototype.update=function(e){if(!this.player||!this.enemyTemplate)return;this.timer+=e;let t=this.spawnInterval;this.app.enemyScaling&&(t*=this.app.enemyScaling.spawnIntervalBonus,t=Math.max(t,.5)),this.timer>=t&&(this.timer=0,this.spawnEnemies())},EnemySpawner.prototype.spawnEnemies=function(){for(let e=0;e<this.spawnAmount;e++){const e=Math.random()*Math.PI*2,t=this.spawnRadius,n=this.player.getPosition().x,a=this.player.getPosition().z,i=this.player.getPosition().y,p=n+Math.cos(e)*t,s=a+Math.sin(e)*t,r=this.enemyTemplate.clone();if(r.enabled=!0,r.setPosition(p,i,s),this.app.root.addChild(r),r.script&&r.script.enemyFollow&&r.script.enemyFollow.initialize(),r.script&&r.script.enemyStats&&this.app.enemyScaling){const e=this.app.enemyScaling,t=r.script.enemyStats;t.currentHp=t.baseHp*e.currentHpBonus,t.damage=t.baseDamage*e.currentDamageBonus,t.speed=t.baseSpeed*e.currentSpeedBonus}}};var Projectile=pc.createScript("projectile");Projectile.attributes.add("speed",{type:"number",default:25}),Projectile.prototype.initialize=function(){this.hasHit=!1;var t=this.app.root.findByTag("player");t.length>0&&t[0].script&&t[0].script.playerStats?this.damage=t[0].script.playerStats.damage:this.damage=1,this.entity.collision.on("collisionstart",this.onCollision,this)},Projectile.prototype.update=function(t){this.hasHit||this.entity.translateLocal(0,0,this.speed*t)},Projectile.prototype.onCollision=function(t){if(this.hasHit)return;let e=t.other;e.tags&&e.tags.has("enemy")&&(e.script&&e.script.enemyHealth&&e.script.enemyHealth.takeDamage(this.damage),this.hasHit=!0,this.entity.destroy())};var EnemyHealth=pc.createScript("enemyHealth");EnemyHealth.prototype.initialize=function(){this.stats=this.entity.script.enemyStats,this.sfx=this.entity.sound},EnemyHealth.prototype.takeDamage=function(t){this.stats.currentHp-=t,this.stats.currentHp<=0&&(this.tryDropPowerup(),this.sfx&&this.sfx.slot("death")&&this.sfx.play("death"),this.entity.destroy())},EnemyHealth.prototype.tryDropPowerup=function(){Math.random()<=.75&&this.app.powerupSystem&&this.app.powerupSystem.spawnPowerup(this.entity.getPosition())};var PlayerShoot=pc.createScript("playerShoot");PlayerShoot.attributes.add("projectileTemplate",{type:"entity"}),PlayerShoot.attributes.add("range",{type:"number",default:10}),PlayerShoot.prototype.initialize=function(){this.timer=0,this.tmp=new pc.Vec3;let t=this.entity.parent;t&&t.script&&t.script.playerStats&&(this.playerStats=t.script.playerStats),this.sfx=this.entity.sound},PlayerShoot.prototype.update=function(t){this.timer+=t;const e=this.getNearestEnemy();if(!e)return;this.aimAt(e);let i=.5;this.playerStats&&(i=1/Math.max(this.playerStats.fireRate,.01)),this.timer>=i&&(this.timer=0,this.spawnProjectile())},PlayerShoot.prototype.getNearestEnemy=function(){const t=this.app.root.findByTag("enemy");if(0===t.length)return null;const e=this.entity.getPosition();let i=null,o=1/0;for(let s of t){const t=s.getPosition().distance(e);t<o&&t<=this.range&&(i=s,o=t)}return i},PlayerShoot.prototype.aimAt=function(t){const e=this.entity.getPosition(),i=t.getPosition();this.tmp.sub2(i,e),this.tmp.y=0,this.tmp.normalize();const o=Math.atan2(this.tmp.x,this.tmp.z)*pc.math.RAD_TO_DEG,s=new pc.Quat;s.setFromEulerAngles(0,o,0),this.entity.setRotation(s)},PlayerShoot.prototype.spawnProjectile=function(){const t=this.projectileTemplate.clone();t.enabled=!0,t.setPosition(this.entity.getPosition()),t.setRotation(this.entity.getRotation()),this.app.root.addChild(t),t.script&&t.script.projectile&&t.script.projectile.initialize(),this.sfx&&this.sfx.slot("shoot")&&this.sfx.play("shoot")};var PlayerRotate=pc.createScript("playerRotate");PlayerRotate.prototype.initialize=function(){},PlayerRotate.prototype.update=function(t){const e=this.app.keyboard;let a=0,s=0;if(e.isPressed(pc.KEY_W)&&(s-=1),e.isPressed(pc.KEY_S)&&(s+=1),e.isPressed(pc.KEY_A)&&(a-=1),e.isPressed(pc.KEY_D)&&(a+=1),0===a&&0===s)return;const i=new pc.Vec3(a,0,s).normalize(),o=new pc.Quat;o.setFromAxisAngle(pc.Vec3.UP,180*Math.atan2(-i.x,-i.z)/Math.PI);const n=this.entity.getRotation().clone();n.slerp(n,o,10*t),this.entity.setRotation(n)};var Recenter=pc.createScript("recenter");Recenter.attributes.add("maxDistance",{type:"number",default:50}),Recenter.prototype.update=function(t){var e=this.app.root.findByTag("player");if(e&&0!==e.length){var o=e[0].getPosition();Math.sqrt(o.x*o.x+o.z*o.z)>this.maxDistance&&this.recenterWorld(o)}},Recenter.prototype.recenterWorld=function(t){var e=new pc.Vec3(-t.x,0,-t.z);this.app.root.findByTag("player").forEach((t=>{var o=t.getPosition().clone().add(e);o.y=t.getPosition().y,t.setPosition(o)})),this.app.root.findByTag("enemy").forEach((t=>{var o=t.getPosition().clone();o.x+=e.x,o.z+=e.z,o.y=t.getPosition().y,t.setPosition(o)})),this.app.root.findByTag("projectile").forEach((t=>{var o=t.getPosition().clone();o.x+=e.x,o.z+=e.z,o.y=t.getPosition().y,t.setPosition(o)})),this.app.root.findByTag("powerup").forEach((t=>{var o=t.getPosition().clone();o.x+=e.x,o.z+=e.z,o.y=t.getPosition().y,t.setPosition(o)}))};var Spinny=pc.createScript("spinny");Spinny.attributes.add("rotationSpeed",{type:"number",default:45,title:"Rotation Speed (degrees/sec)"}),Spinny.attributes.add("axis",{type:"vec3",default:new pc.Vec3(0,1,0),title:"Rotation Axis"}),Spinny.prototype.initialize=function(){this.axis.normalize()},Spinny.prototype.update=function(t){var i=pc.math.degToRad(this.rotationSpeed*t);this.entity.rotate(this.axis.x*i,this.axis.y*i,this.axis.z*i)};var PlayerHealth=pc.createScript("playerHealth");PlayerHealth.prototype.initialize=function(){this.stats=this.entity.script.playerStats,this.stats?(this.currentHp=this.stats.maxHp,this.canTakeDamage=!0,this.sfx=this.entity.sound,this.entity.collision.on("collisionstart",this.onCollision,this)):console.error("PlayerHealth: playerStats script not found on entity!")},PlayerHealth.prototype.onCollision=function(t){var e=t.other;if(e.tags.has("enemy")&&this.canTakeDamage){var a=1;e.script&&e.script.enemyStats&&(a=e.script.enemyStats.damage,this.sfx&&this.sfx.slot("damage")&&this.sfx.play("damage")),this.currentHp-=a,console.log("Player HP:",this.currentHp),this.currentHp<=0&&(this.app.scenes.changeScene("Game Over"),this.entity.destroy()),this.canTakeDamage=!1,this.cooldownTimer=this.stats.damageCooldown||.5}},PlayerHealth.prototype.update=function(t){this.canTakeDamage||(this.cooldownTimer-=t,this.cooldownTimer<=0&&(this.canTakeDamage=!0))};var EnemyStats=pc.createScript("enemyStats");EnemyStats.attributes.add("maxHp",{type:"number",default:3}),EnemyStats.attributes.add("damage",{type:"number",default:1}),EnemyStats.attributes.add("speed",{type:"number",default:3}),EnemyStats.prototype.initialize=function(){if(this.baseHp=this.maxHp,this.baseDamage=this.damage,this.baseSpeed=this.speed,this.app.enemyScaling){const e=this.app.enemyScaling;this.maxHp=this.baseHp*e.currentHpBonus,this.damage=this.baseDamage*e.currentDamageBonus,this.speed=this.baseSpeed*e.currentSpeedBonus}this.currentHp=this.maxHp};var PlayerStats=pc.createScript("playerStats");PlayerStats.attributes.add("maxHp",{type:"number",default:10}),PlayerStats.attributes.add("moveSpeed",{type:"number",default:6}),PlayerStats.attributes.add("damage",{type:"number",default:1}),PlayerStats.attributes.add("fireRate",{type:"number",default:1}),PlayerStats.attributes.add("regenRate",{type:"number",default:.2}),PlayerStats.attributes.add("invincibilityTime",{type:"number",default:.5}),PlayerStats.attributes.add("hpGrowth",{type:"number",default:.25}),PlayerStats.attributes.add("damageGrowth",{type:"number",default:.1}),PlayerStats.attributes.add("speedGrowth",{type:"number",default:.05}),PlayerStats.attributes.add("fireRateGrowth",{type:"number",default:.05}),PlayerStats.attributes.add("regenGrowth",{type:"number",default:.05}),PlayerStats.attributes.add("growthInterval",{type:"number",default:5}),PlayerStats.prototype.initialize=function(){this.currentHp=this.maxHp,this.canTakeDamage=!0,this.invincibilityTimer=0,this.growthTimer=0},PlayerStats.prototype.update=function(t){this.growthTimer+=t,this.growthTimer>=this.growthInterval&&(this.growthTimer=0,this.scalePlayer()),this.canTakeDamage||(this.invincibilityTimer-=t,this.invincibilityTimer<=0&&(this.canTakeDamage=!0)),this.currentHp<this.maxHp&&(this.currentHp+=this.regenRate*t,this.currentHp>this.maxHp&&(this.currentHp=this.maxHp))},PlayerStats.prototype.scalePlayer=function(){this.maxHp+=this.hpGrowth,this.damage+=this.damageGrowth,this.moveSpeed+=this.speedGrowth,this.fireRate+=this.fireRateGrowth,this.regenRate+=this.regenGrowth,this.currentHp=this.maxHp};var EnemyDamage=pc.createScript("enemyDamage");EnemyDamage.prototype.initialize=function(){this.stats=this.entity.script.enemyStats},EnemyDamage.prototype.getDamage=function(){return this.stats.damage};var EnemyScaler=pc.createScript("enemyScaler");EnemyScaler.attributes.add("hpGrowth",{type:"number",default:1.05}),EnemyScaler.attributes.add("damageGrowth",{type:"number",default:1.02}),EnemyScaler.attributes.add("speedGrowth",{type:"number",default:1.05}),EnemyScaler.attributes.add("spawnIntervalMultiplier",{type:"number",default:.95}),EnemyScaler.prototype.initialize=function(){this.timer=0,this.currentHpBonus=1,this.currentDamageBonus=1,this.currentSpeedBonus=1,this.spawnIntervalBonus=1,this.app.enemyScaling=this},EnemyScaler.prototype.update=function(e){this.timer+=e,this.timer>=10&&(this.timer=0,this.scaleEnemies())},EnemyScaler.prototype.scaleEnemies=function(){this.currentHpBonus*=this.hpGrowth,this.currentDamageBonus*=this.damageGrowth,this.currentSpeedBonus*=this.speedGrowth,this.spawnIntervalBonus*=this.spawnIntervalMultiplier};var PowerupSystem=pc.createScript("powerupSystem");PowerupSystem.attributes.add("powerupTemplate",{type:"entity"}),PowerupSystem.prototype.initialize=function(){this.app.powerupSystem=this},PowerupSystem.prototype.spawnPowerup=function(e){if(!this.powerupTemplate)return;let t=this.powerupTemplate.clone();t.enabled=!0,t.setPosition(e),this.app.root.addChild(t)};var Powerup=pc.createScript("powerup");Powerup.attributes.add("hpBoost",{type:"number",default:1}),Powerup.attributes.add("damageBoost",{type:"number",default:.2}),Powerup.attributes.add("speedBoost",{type:"number",default:.2}),Powerup.attributes.add("fireRateBoost",{type:"number",default:.05}),Powerup.attributes.add("regenBoost",{type:"number",default:.05}),Powerup.prototype.initialize=function(){this.entity.collision.on("collisionstart",this.onPickup,this),this.sfx=this.entity.sound},Powerup.prototype.onPickup=function(t){let e=t.other;if(e.tags&&e.tags.has("player")){let t=e.script.playerStats;this.sfx&&this.sfx.slot("pickup")&&this.sfx.play("pickup"),t.maxHp+=this.hpBoost,t.damage+=this.damageBoost,t.moveSpeed+=this.speedBoost,t.fireRate+=this.fireRateBoost,t.regenRate+=this.regenBoost,this.entity.destroy()}};